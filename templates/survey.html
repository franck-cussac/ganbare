{{#partial main_section}}
	<header>
	<h1>Kysely <span id="progressMeter"></span></h1>
	</header>
		<div id="surveyBox">
			<h2 id="questionText"></h2>
			<div id="answerButtons">
			</div>
		</div>

		<script>

		function surveyReady() {
			$("#questionText").text("Kiitos vastauksista! Nyt japanin harjoittelun pariin.");
			$('<form action="/ok" method="POST">\
				<input type="hidden" value="survey" name="event_ok">\
				<input type="submit" value="Ok" style="min-width: 50%; margin-top: 1em;">\
			</form>').appendTo("#answerButtons");
		};

		function incrementFactory() {

			var answers_0 = [
				"Aloita kysely!",
			];

			var answers_1 = [
				'satunnaisesti; <br class="smallscreen">joitakin kertoja<br>vuodessa tai harvemmin',
				'silloin tällöin, mutta <br class="smallscreen">joskus on viikkojen<br>tai kuukausien taukoja',
				'viikoittain tai ainakin<br>monta kertaa kuussa',
				'monta kertaa viikossa',
				'päivittäin',
			];

			var answers_2 = [
				"en ole käynyt",
				"olen käynyt kerran",
				"olen käynyt joitakin kertoja",
				"käyn vähintään kerran muutamassa vuodessa",
				"käyn kerran vuodessa tai useammin",
			];

			var answers_3 = [
				"käyn monta tuntia viikossa",
				"käyn kerran viikossa",
				"olen käynyt satunnaisesti/<wbr>lyhytkestoisesti",
				"en ole käynyt",
			];

			var textfield = "textfield";
			var fourfold = "fourfold";
			var languages = "languages";

			var questions = [

			{q: "Mitkä uskot olevan vahvuutesi japanin kielitaidossasi?", a: fourfold},
			{q: "Kysymme alkuun lyhyesti siitä, millä tavalla olet yleensä tekemisissä japanin kielen kanssa.", a: answers_0},
			{q: "Juttelen japaniksi verkossa, esimerkiksi Facebookissa, Twitterissä tai Linessä.", a: answers_1},
			{q: "Luen japanilaisia blogeja.", a: answers_1},
			{q: "Katson YouTubesta ym. videopalveluista japaninkielisiä v-blogeja tai let's play -videoita.", a: answers_1},
			{q: "Kuuntelen japanilaisia radio-ohjelmia tai podcasteja.", a: answers_1},
			{q: "Kuuntelen japanilaista musiikkia intensiivisesti; kuuntelen tai selvitän, mitä sanat tarkoittavat.", a: answers_1},
			{q: "Katson animea.", a: answers_1},
			{q: "Puhun japania livenä japanilaisten<br/>tuttavien kanssa", a: answers_1},
			{q: "Katson japanilaisia draamasarjoja tai näytelmäelokuvia.", a: answers_1},
			{q: "Katson japanilaisia ajankohtaisohjelmia, komediaa ym. TV-ohjelmia.", a: answers_1},
			{q: "Luen mangaa.", a: answers_1},
			{q: "Luen japanilaisia romaaneja, nuortenkirjoja ym. proosaa.", a: answers_1},
			{q: "Matkustan Japaniin.", a: answers_2},
			{q: "Opiskelen japania käymällä kursseilla.", a: answers_3},
			{q: "Opiskelen japania jollain muulla tavalla, millä?", a: textfield},
			{q: "Jos haluat tarkentaa aiempia vastauksia, sana on vapaa:", a: textfield},
			{q: "Mikä on äidinkielesi?", a: languages},
			];

			var i = 0;
			var main = $("#main");
			var surveyBox = $("#surveyBox");
			var answerButtons = $("#answerButtons");
			var questionText = $("#questionText");
			var progressMeter = $("#progressMeter");

			var answered = [];

			function answerQuestion(answerData) {
				main.css("min-height", main.css("height"));
				$.ajax({
					type: "POST",
					url: "/api/eventdata/survey",
					contentType : "application/json",
					data: JSON.stringify(answerData),
				});
				surveyBox.slideUp(400, function() {
					increment();
					surveyBox.fadeIn();
				});
			}

			function increment() {
				answerButtons.empty();
				if (i === questions.length) {
					return surveyReady();
				}
				progressMeter.text("("+(i+1)+"/"+questions.length+")");
				var question = questions[i].q;
				var answers = questions[i].a;
				questionText.html(question);
				if (Array.isArray(answers)) {

					answers.forEach(function(a, j) {
						var button = $('<button class="multilineButton">'+a+'</button>');

						button.appendTo($('<p></p>').appendTo(answerButtons));
						button.click(function() { answerQuestion({q: question, a: button.html()})});
					});

				} else if (answers === "textfield") {

					var textarea = $('<textarea></textarea>');

					textarea.appendTo(answerButtons);

					$('<button style="min-width: 50%; margin-top: 1em;">Ok</button>')
						.appendTo(answerButtons)
						.click(function() { answerQuestion({q: question, a: textarea.val()}) });

				} else if (answers === "fourfold") {

					var suullinen_kirjallinen = 50;
					var ymmarrtaminen_tuottaminen = 50;

					var fourfold = $('<div style="border: 1px solid grey; position: relative; margin: auto; margin-bottom: 1em; width: 16em; height: 16em;">\
						<span style="position: absolute; left: -14%; top: -12%;">kuuntelu</span>\
						<span style="position: absolute; left: -14%; bottom: -12%;">puhuminen</span>\
						<span style="position: absolute; right: -14%; top: -12%;">lukeminen</span>\
						<span style="position: absolute; right: -14%; bottom: -12%;">kirjoittaminen</span>\
						<span style="position: absolute; text-align: center; right: 0; left: 0; top: 0.1em;">ymmärtäminen</span>\
						<span style="position: absolute; text-align: center; right: 0; left: 0; bottom: 0.1em;">tuottaminen</span>\
						<span style="position: absolute; transform: translate(-7em, 7em) rotate(90deg);text-align: center; left: 0; right: 0;">suullinen</span>\
						<span style="position: absolute; transform: translate(7em, 7em) rotate(-90deg);text-align: center; left: 0; right: 0;">kirjallinen</span>\
						<span id="fourfoldSpot" style="border: 1em solid red; border-radius: 1em; position: absolute; margin: -1em; left: 50%; top: 50%;"></span>\
						<div id="fourfoldTouchpad" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0;"></div>\
						</div>').appendTo(answerButtons);
					$("#fourfoldTouchpad").click(function(ev) {
						suullinen_kirjallinen = ev.offsetX/$(this).width()*100;
						ymmarrtaminen_tuottaminen = ev.offsetY/$(this).height()*100;
						console.log(suullinen_kirjallinen, ymmarrtaminen_tuottaminen);
						$("#fourfoldSpot").css("left", suullinen_kirjallinen+"%");
						$("#fourfoldSpot").css("top", ymmarrtaminen_tuottaminen+"%");
					});
					var answerData = {q: question, a: {suullinen_kirjallinen: suullinen_kirjallinen, ymmarrtaminen_tuottaminen: ymmarrtaminen_tuottaminen} };

					$('<button style="min-width: 60%; margin-top: 1em;">Ok</button>')
						.appendTo(answerButtons)
						.click(function() { answerQuestion({q: question, a: null}) });

				} else if (answers === "languages") {
					$(' <input type="checkbox" id="suomi"><label for="suomi">suomi</label>\
						<input type="checkbox" id="ruotsi"><label for="ruotsi">ruotsi</label>\
						<label>muu, mikä?</label>\
						<input type="text" id="muukieli">').appendTo(answerButtons);

					$('<button style="min-width: 50%; margin-top: 1em;">Ok</button>')
						.appendTo(answerButtons)
						.click(function() {
							var answerData = {q: question, a:
								{	suomea: $("#suomi").is(":checked"),
									ruotsia: $("#ruotsi").is(":checked"),
									muuta: $("#muukieli").val(),
								}
							};
							answerQuestion(answerData);
						});
				};
				i++;
			};
			return increment;
		}
		var increment = incrementFactory();
		increment();
		</script>

{{/partial}}

{{~> base.html ~}}
